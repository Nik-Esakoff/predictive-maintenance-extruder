# Прогнозирование технологических остановок экструдера в производстве полипропилена

**Выпускная квалификационная работа НИУ ВШЭ**

## Задача проекта

Разработка предиктивной модели для раннего предупреждения остановок технологической линии гранулирования полипропилена на основе анализа многомерных временных рядов промышленных данных.

## Исходные данные

### Общая характеристика
- **Период**: 01.01.2017 - 26.06.2017
- **Объем данных**: 1,5 млн записей
- **Признаки**: 43 технологических параметра
- **Частота записи**: исходная высокая частота (после ресемплирования - 10 минут)

### Функциональные группы признаков
1. **Сила тока электродвигателей** - параметры нагрузки оборудования
2. **Частота вращения электродвигателей** - скоростные характеристики
3. **Температурные параметры**:
   - Температура полипропилена на разных участках цилиндра
   - Внешние температуры цилиндра
   - Температура щелевого диска
   - Температура охлаждающей воды
4. **Параметры подачи материала**:
   - Положение ножей
   - Расход подачи порошка полипропилена
5. **Параметры давления**:
   - Давление расплава до и после сит
   - Давление до фильеры

## Предобработка данных

### Обработка пропусков
- **Пропуски в начале рядов**: отрезаны
- **Пропуски в середине**: заполнены предыдущим значением

### Ресемплирование
- **Интервал**: 10 минут
- **Метод агрегации**: 
  - `max()` - максимальное значение за период
  - `min()` - минимальное значение за период  
  - `mean()` - среднее значение за период
- **Цель ресемплирования**:
  - Уменьшение размерности данных
  - Снижение уровня шума
  - Устранение части пропусков

### Обнаруженные закономерности
- **Месячная сезонность**: выявлена по всем признакам
- **Ковариаты**: месяцы в формате One-Hot Encoding использованы для улучшения прогнозных качеств модели

## Архитектура модели

### Параметры модели
| Параметр | Значение | Описание |
|----------|----------|----------|
| **Входной сегмент** | 288 точек | 48 часов исторических данных |
| **Прогнозный горизонт** | 1 точка | Прогноз на 10 минут вперед |
| **Размер эмбеддингов** | 128 | Размерность скрытых представлений |
| **Feed-forward сеть** | 512 | Размерность внутреннего слоя |
| **Dropout** | 0.1 | Вероятность исключения нейронов |
| **Функция активации** | ReLU | Обеспечение нелинейности |
| **Количество attention heads** | 4 | Параллельные механизмы внимания |
| **Энкодер** | 2 слоя | Обработка исторических данных |
| **Декодер** | 1 слой | Генерация прогноза |
| **Оптимизатор** | Adam | Алгоритм оптимизации |
| **Scheduler** | CosineAnnealingLR | Планировщик скорости обучения |

## Методология прогнозирования

### Отбор признаков для прогнозирования
1. **Анализ ошибок MAE**: Выбраны признаки с наибольшими значениями ошибок на аномалиях
2. **Оценка качества аппроксимации**: Дополнительно оценен коэффициент детерминации (R²)
3. **Критерий отбора**: Признаки должны иметь высокую ошибку на аномалиях И хорошую аппроксимацию в нормальном режиме

### Реализованные методы
- **Адаптивное тестирование** на коротких аномалиях
- **Взвешенная MAE** с коэффициентом 3.0 для важных признаков
- **Расширенное временное окно** (48 часов) для раннего обнаружения
- **Фильтрация ложных срабатываний** (минимум 3 последовательных детекции)

## Результаты детектирования

### Статистика обнаружения
| Метрика | Значение | Интерпретация |
|---------|----------|---------------|
| **Всего аномалий в тесте** | 9 | Реальные события для оценки |
| **Обнаружено (True Positives)** | 7 | Корректно выявленные аномалии |
| **Пропущено (False Negatives)** | 2 | Не обнаруженные аномалии |
| **Ложных срабатываний (False Positives)** | 19 | Ошибочные детекции за полгода |

### Метрики качества
- **Precision (Точность)**: 0.269
  - *Интерпретация*: 26.9% детекций соответствуют реальным аномалиям
  - *Необходимость оптимизации*: Высокий уровень ложных срабатываний

- **Recall (Полнота)**: 0.778  
  - *Интерпретация*: Обнаружено 77.8% реальных аномалий
  - *Сильная сторона*: Высокая способность к обнаружению критических событий

- **F1-score**: 0.400
  - *Интерпретация*: Баланс между точностью и полнотой
  - *Потенциал улучшения*: Требуется оптимизация пороговых значений

## Структура проекта

### Ноутбуки исследования
1. **`1_eda_data_analysis.ipynb`**
   - Исследовательский анализ данных
   - Обработка пропусков
   - Анализ стационарности и сезонности
   - Ресемплирование и агрегация
   - Создание ковариат (One-Hot Encoding месяцев)

2. **`2_model_training_testing.ipynb`**
   - Обучение Transformer-модели
   - Тестирование на нормальных данных
   - Адаптивное тестирование на аномалиях
   - Детектирование и оценка метрик
   - Визуализация результатов
